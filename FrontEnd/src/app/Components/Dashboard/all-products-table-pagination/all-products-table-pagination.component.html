<!-- Alert Messages -->
<div class="w-100 alert alert-danger my-3 text-start pl-2" *ngIf="uploadErrorMessage">
  <div>{{ uploadErrorMessage }}</div>
</div>

<div class="w-100 alert alert-success my-3 text-start pl-2" *ngIf="uploadSuccessMessage">
  <div>{{ uploadSuccessMessage }}</div>
</div>

<!-- All Products Table -->
<div class="container-fluid p-0">
  <div class="w-100 alert-danger my-3 text-center" *ngIf="errorMessage">
    <p>{{ errorMessage }}</p>
  </div>
  <div class="w-100 alert-success my-3 text-center" *ngIf="successMessage">
    <p>{{ successMessage }}</p>
  </div>
  <div class="mat-elevation-z8 w-100">
    <table mat-table [dataSource]="dataSource" class="w-100">
      <!-- Position Column -->
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>name</th>
        <td mat-cell *matCellDef="let element">{{ element.name }}</td>
      </ng-container>

      <!-- Name Column -->
      <ng-container matColumnDef="price">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Price</th>
        <td mat-cell *matCellDef="let element">{{ element.price }}</td>
      </ng-container>

      <!-- Weight Column -->
      <ng-container matColumnDef="category">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Category</th>
        <td mat-cell *matCellDef="let element">{{ element.category }}</td>
      </ng-container>

      <!-- Symbol Column -->
      <ng-container matColumnDef="rate">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Rate</th>
        <td mat-cell *matCellDef="let element">{{ element.rate }}</td>
      </ng-container>

      <ng-container matColumnDef="discount">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Discount</th>
        <td mat-cell *matCellDef="let element">{{ element.discount }}</td>
      </ng-container>

      <ng-container matColumnDef="itemsinStock">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>itemsinStock</th>
        <td mat-cell *matCellDef="let element">{{ element.itemsinStock }}</td>
      </ng-container>
      <!-- Action Column -->
      <ng-container matColumnDef="action" class="action-container">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Action</th>
        <td mat-cell *matCellDef="let element">
          <button
            class="copy"
            (click)="setSelectedId(element._id)"
            data-bs-toggle="modal"
            data-bs-target="#DeleteModal"
          >
            <i class="bi bi-trash"></i>
          </button>
          <button
            class="copy"
            data-bs-toggle="modal"
            data-bs-target="#editModal"
            (click)="editElement(element)"
          >
            <i class="bi bi-pen"></i>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>

    <mat-paginator
      [pageSizeOptions]="[7, 25, 50, 100]"
      [pageSize]="7"
      [showFirstLastButtons]="true"
      [length]="dataSource.data.length"
    ></mat-paginator>
  </div>
</div>

<!--Update Product Modal-->
<div class="modal fade" id="editModal">
  <div
    class="modal-dialog modal-confirm modal-dialog-centered modal-md my-auto"
  >
    <div class="modal-content bg-white" [style.background]="'url(./assets/images/modal-bg.png) no-repeat top left'">
      <div class="modal-header">
        <div class="w-100">
          <h2 class="modal-title text-center">Update Product</h2>
        </div>
      </div>
      <div class="modal-body">
        <form
          [formGroup]="editProductForm"
          (ngSubmit)="updateProduct()"
          enctype="multipart/form-data"
        >
          <div class="col-12 d-flex justify-content-between flex-wrap">
            <div class="form-group my-1 col-12">
              <input
                type="text"
                class="form-control w-100"
                name="productName"
                placeholder="Product Name"
                formControlName="productName"
                autocomplete="off"
                [ngClass]="{
                  'is-invalid':
                    productName?.invalid,
                  'is-valid':
                    !productName?.invalid
                }"
              />
              <div
                class="alert alert-danger text-danger p-0 text-start px-3 w-100"
                *ngIf="
                  productName?.invalid &&
                  (productName?.dirty || productName?.touched)
                "
              >
                <p style="font-size: small; margin: 0">
                  <small *ngIf="productName?.errors?.['required']"
                    >Product Name is Required</small
                  >
                  <small *ngIf="productName?.errors?.['pattern']"
                    >Product Name Must be greater than 3</small
                  >
                </p>
              </div>
            </div>

            <div class="form-group my-1 col-12">
              <textarea
                type="text"
                class="form-control"
                name="productDesc"
                placeholder="Product Description"
                formControlName="productDesc"
                rows="3"
                autocomplete="off"
                [ngClass]="{
                  'is-invalid':
                    productDesc?.invalid,
                  'is-valid':
                    !productDesc?.invalid
                }"
              >
                <div
                class="alert alert-danger text-danger p-0 text-start px-3"
                *ngIf="
                  productDesc?.invalid &&
                  (productDesc?.dirty || productDesc?.touched)
                "
                >
                  <p style="font-size: small; margin: 0">
                    <small *ngIf="productDesc?.errors?.['required']"
                      >Product Description is Required</small
                    >
                  </p>
                </div>
              </textarea>
            </div>

            <div class="form-group my-1 col-3">
              <input
                type="number"
                class="form-control w-100"
                name="productPrice"
                placeholder="Price"
                formControlName="productPrice"
                autocomplete="off"
                [ngClass]="{
                  'is-invalid':
                    productPrice?.invalid,
                  'is-valid':
                    !productPrice?.invalid
                }"
              />
              <div
                class="alert alert-danger text-danger p-0 mt-2 text-start px-3"
                *ngIf="productPrice?.invalid && (productPrice?.dirty)"
              >
                <p style="font-size: small; margin: 0">
                  <small *ngIf="productPrice?.errors?.['required']"
                    >Product Price is Required.</small
                  >
                  <small *ngIf="productPrice?.errors?.['pattern']"
                    >Product Price must be a Positive Number</small
                  >
                </p>
              </div>
            </div>

            <div class="form-group my-1 col-3">
              <input
                type="number"
                class="form-control w-100"
                name="productDiscount"
                placeholder="Discount"
                formControlName="productDiscount"
                autocomplete="off"[ngClass]="{
                  'is-invalid':
                    productDiscount?.invalid,
                  'is-valid':
                    !productDiscount?.invalid
                }"
              />
              <div
                class="alert alert-danger text-danger p-0 mt-2 text-start px-3"
                *ngIf="
                  productDiscount?.invalid
                "
              >
                <p style="font-size: small; margin: 0">
                  <small *ngIf="productDiscount?.errors?.['required']"
                    >productDiscount is Required</small
                  >
                  <small *ngIf="productDiscount?.errors?.['pattern']"
                    >Product Discount must be a Positive umber.</small
                  >
                </p>
              </div>
            </div>

            <div class="form-group my-1 col-5">
              <input
                type="number"
                class="form-control w-100"
                name="productItemsInStock"
                placeholder="No. of Items in Stock"
                formControlName="productItemsInStock"
                autocomplete="off"[ngClass]="{
                  'is-invalid':
                    productItemsInStock?.invalid,
                  'is-valid':
                    !productItemsInStock?.invalid
                }"
              />
              <div
                class="alert alert-danger text-danger p-0 mt-2 text-start px-3"
                *ngIf="
                  productItemsInStock?.invalid &&
                  (productItemsInStock?.dirty)
                "
              >
                <p style="font-size: small; margin: 0">
                  <small *ngIf="productItemsInStock?.errors?.['required']"
                    >No. Items In Stock is Required.</small
                  >
                  <small *ngIf="productItemsInStock?.errors?.['pattern']"
                    >No. Items In Stock Must be a valid Number</small
                  >
                </p>
              </div>
            </div>

            <div class="form-group my-1 col-12">
              <label
                >Category
                <i class="fw-light text-secondary">
                  (Hint: You can Choose Multiple Ones)
                </i></label
              >
              <div>
                <select
                  multiple
                  class="selectpicker form-control"
                  formControlName="productCategory"
                  [ngClass]="{
                    'is-invalid':
                      productCategory?.invalid,
                    'is-valid':
                      !productCategory?.invalid
                  }"
                >
                  <option value="Indoor Plants">Indoor Plants</option>
                  <option value="Ceramic Pots">Ceramic Pots</option>
                  <option value="Low Maintenance">Low Maintenance</option>
                  <option value="Plant Bundle">Plant Bundle</option>
                  <option value="Air Purifying">Air Purifying</option>
                </select>
                <div
                  class="alert alert-danger text-danger p-0 text-start px-3"
                  *ngIf="
                    productCategory?.invalid && (productCategory?.dirty)
                  "
                >
                  <p style="font-size: small; margin: 0">
                    <small *ngIf="productCategory?.errors?.['required']"
                      >Product Category is Required</small
                    >
                  </p>
                </div>
              </div>
            </div>

            <div class="form-group my-1 col-12">
              <label
                >Images
                <i class="fw-light text-secondary">
                  (Hint: You can Choose Multiple Ones)
                </i></label
              >
              <input
                type="file"
                class="form-control w-100"
                name="imageUrl"
                formControlName="imageUrl"
                (change)="onFileInputChange($event)"
                multiple
              />
            </div>

            <div
              class="text-danger text-danger p-0 text-center px-3 mt-3 text-center"
              *ngIf="formErrorMessage"
            >
              <p>{{ formErrorMessage }}</p>
            </div>
          </div>

          <div class="d-flex justify-content-end my-3">
            <button class="btn btn-light border" data-bs-dismiss="modal">
              Cancel
            </button>
            <button class="btn btn-info submit-btn" type="submit" data-bs-dismiss="modal"
            [disabled]="!editProductForm.valid">
              Update
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Delete Product Modal -->
<div class="modal fade" id="DeleteModal">
  <div class="modal-dialog modal-confirm modal-dialog-centered my-auto">
    <div class="modal-content">
      <div class="modal-header">
        <div class="d-flex flex-column justify-content-center w-100">
          <div class="icon-box text-center">
            <img src="./assets/images/icons/dying.gif" />
          </div>
          <h4 class="modal-title">
            Confirmation <br /><span class="userName-Style"
              >Are you sure to delete this product?
            </span>
          </h4>
        </div>
      </div>
      <div class="modal-footer pb-0">
        <form class="w-100" (click)="deletedSelectedProduct()">
          <button
            type="button"
            class="btn btn-danger w-100"
            data-bs-dismiss="modal"
          >
            Delete
          </button>
        </form>
      </div>
    </div>
  </div>
</div>
